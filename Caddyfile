# Caddy configuration for Wake-up Coach with automatic HTTPS
# External port 8443 is mapped to internal port 443 in docker-compose
# Replace goloka.no-ip.biz with your actual domain if different

goloka.no-ip.biz {
    # Automatic HTTPS with Let's Encrypt
    # Caddy will automatically obtain and renew SSL certificates
    
    # Reverse proxy all requests to the FastAPI app
    reverse_proxy wakeup-coach:8000 {
        # WebSocket support
        header_up Upgrade {http.request.header.Upgrade}
        header_up Connection {http.request.header.Connection}
        
        # Pass the original host including port for Twilio signature validation
        header_up Host {http.request.host}
        header_up X-Forwarded-Host {http.request.host}
        header_up X-Forwarded-Proto {http.request.scheme}
        header_up X-Real-IP {http.request.remote.host}
    }
    
    # Enable access logs
    log {
        output stdout
        format console
    }
}

